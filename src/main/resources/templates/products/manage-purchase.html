<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Manage Purchase</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href='https://fonts.googleapis.com/css?family=Poppins' rel='stylesheet'>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="icon" href=
    "./etiquette.png"
            type="image/x-icon" />
    <style>
        body {
	font-family: 'Poppins';
	display: flex;
	background-color: #f0f2f5;
}

/* Sidebar base styling */
.sidebar {
    display: flex;
    flex-direction: column;
    background-color: #f8f9fa;
    border-right: 1px solid #dbe0e6;
    position: fixed;
    top: 66px;
    bottom: 0;
    left: 0;
    width: 260px;
    padding: 20px;
    transition: all 0.5s ease;
    z-index: 1001;
}

/* Logo styling */
.header-left {
    display: flex;
    align-items: center;
    position: sticky;
    top: 0; /* Position from the top of the viewport */
    height: 67px;
    width: 116%; /* Ensure it spans the full width if needed */
    background-color: #f8f9fa;
    padding: 0 24px;
    z-index: 1000; /* Ensures it stays on top of other elements when scrolling */
    border-bottom: 1px solid #ddd;

    .logo {
        display: flex;
        align-items: center;
        img {
            width: 85px; 
            margin-right: 8px;
        }
        .h5 {
            font-size: 18px;
            color: #092C4C;
        }
    }
}


/* Sidebar menu styling */
.sidebar-menu > ul > li {
    margin-bottom: 24px;
}

.sidebar-menu > ul > li > a {
    display: flex;
    align-items: center;
    padding: 10px 15px;
    color: #092C4C;
    border-radius: 5px;
    transition: background-color 0.3s, color 0.3s;
}

.sidebar-menu > ul > li > a svg {
    min-width: 16px;
    width: 16px;
    height: 16px;
    margin-right: 10px;
    color: #637381;
}

.sidebar-menu > ul > li > a span {
    font-size: 15px;
    font-weight: 500;
    color: #67748E;
}

/* Hover and active states */
.sidebar-menu > ul > li > a:hover {
    background-color: rgba(254, 159, 67, 0.08);
    color: #FE9F43;
}

.sidebar-menu > ul > li.active > a,
.sidebar-menu > ul > li > a.active {
    background-color: rgba(254, 159, 67, 0.08);
    color: #FE9F43;
}

.sidebar-menu > ul > li > a:hover svg,
.sidebar-menu > ul > li > a.active svg {
    color: #FE9F43;
}

/* Main content margin for sidebar */
#main-content {
    margin-left: -52px;
    
    width: calc(100% - 260px);
}

/* Responsive styling */
@media (max-width: 991.98px) {
    .sidebar {
        margin-left: -260px;
        z-index: 1041;
        transition: all 0.4s ease;
        width: 260px;
    }

    #main-content {
        margin-left: 0;
        width: 100%;
    }
}

@media (max-width: 575px) {
    .sidebar {
        width: 100%;
    }

    #main-content {
        margin-left: 0;
    }
}

#main-content {
	margin-left: 26px;
	width: 100%;
}

.navbar {
	background-color: #f8f9fa;
	color: white;
	position: sticky;
	top: 0;
    overflow: hidden;
}

.navbar span {
	color: #67748E;
	font-weight: bold;
}

h2 {
	color: #333;
	font-size: 24px;
	text-align: center;
}

        table {
            background-color: #ffffff;
            border-radius: 5px;
            overflow: hidden;
        }

        th, td {
            text-align: center;
        }

        .btn-danger {
            background-color: #ffff;
            border: none;
            align-items: center;
        }

        .btn-danger:hover {
            background-color: #c82333;
        }
        #search {
			height: 38px;
			width: 298px;
			border-radius: 8px;
			padding: 10px;
		}
		.table-top {
   
    padding: 10px; /* Add some padding inside the box */
    border: 1px solid #ced4da; /* Add border around the box */
    border-radius: 0.25rem; /* Rounded corners for the box */
    background-color: #ffffff; /* Light background color for visibility */
}

.input-group {
    flex-grow: 1; /* Allow input group to grow and take available space */
    max-width: 300px; /* Set a maximum width for the search input */
}

.input-group .form-control {
    border-radius: 0.25rem; /* Rounded corners for the input */
}

.input-group-text {
    background-color: white; /* Background for the search icon */
    border: 1px solid #ced4da; /* Border matching the input */
    border-left: none; /* Remove left border to connect with input */
    border-radius: 0 0.25rem 0.25rem 0; /* Rounded corners for the icon */
}
.filter{
	background: #0d6efd;
    width: 36px;
    height: 36px;
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    align-items: center;
    -webkit-box-align: center;
    -ms-flex-align: center;
    justify-content: center;
    -webkit-justify-content: center;
    -ms-flex-pack: center;
    padding: 0;
    margin-right: 15px;
    border:none;
    border-radius: 0.5em;
}
#logout{
	background:#dc3545;
}
        
    </style>
</head>
<body>
   

<div class="header">
    <div class="header-left">
        <a href="/products" class="logo">
            <img src="/logo.png" alt="Logo">
            <span class="h5" style="visibility: hidden";>Dashboard</span>
        </a>
    </div>
</div>


    <div id="sidebar" class="sidebar bg-light">
    
    <div class="sidebar-menu">
        <ul class="nav flex-column">
        
          <li class="nav-item active">
                <a class="nav-link" href="#" onclick="showDashboard();">
                    <span class="material-symbols-outlined">dashboard</span>&nbsp;<span>Dashboard</span>
                </a>
            </li>
            
            <li class="nav-item active">
                <a class="nav-link" href="/products" onclick="showProductsPage()">
                    <span class="material-symbols-outlined">
package_2
</span>
                    &nbsp;<span>Products</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#">
                    <span class="material-symbols-outlined">
shelves
</span>&nbsp;
                    <span>Manage Sales</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/products#" onclick="showAddCashier()">
                    <span class="material-symbols-outlined">
badge
</span>&nbsp;
                    <span>Add Cashier</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/products#" onclick="showCompanySettings()">
                    <span class="material-symbols-outlined">
manage_accounts
</span>&nbsp;
                    <span>Company Settings</span>
                </a>
            </li>
        </ul>
    </div>
</div>
	

    <div id="main-content" class="container-fluid">
       <nav class="navbar navbar-light " style="bottom: 2.4em;left: 2em;
    padding:0.9em;
">
            <div class="container-fluid">
                <div class="d-flex align-items-center ms-auto">
                    <span class="me-3" th:text="${username}">Username</span>
                    <form action="/logout" method="post">
                        <button type="submit" class="btn btn-danger" id="logout">Logout</button>
                    </form>
                </div>
            </div>
        </nav>
        
		<div class="row">
		  <div class="col">
	       
	            <h4 class="text-start mt-2">Units</h4>
	            <h6 class="text-start">Manage your units</h6>
	       
	       </div>
	       <div class="col">
		        <div class="page-btn" id="add">
		        	<button type="button" class="btn btn-primary mt-3" data-bs-toggle="modal" data-bs-target="#addUnitsModal" style="float:right;"> <span
							class="material-symbols-outlined" style="vertical-align: bottom;">add_circle</span>&nbsp; Add New Unit
						</button>
		        </div>
        	</div>
        </div>
        

        <!-- Add Units Modal -->
<div class="modal fade" id="addUnitsModal" tabindex="-1" aria-labelledby="addUnitsModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addUnitsModalLabel">Add New Units</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Success and Error Messages Inside Modal -->
                <div th:if="${successMessage}" class="alert alert-success" role="alert">
                    <span th:text="${successMessage}"></span>
                </div>
                <div th:if="${errorMessage}" class="alert alert-danger" role="alert">
                    <span th:text="${errorMessage}"></span>
                </div>

                <!-- Add Purchase Form Inside Modal -->
                <form th:action="@{/manage-purchase}" method="post">
                    <div class="mb-3">
                        <label for="product" class="form-label">Select Product:</label>
                        <select class="form-select" name="productId" id="product" required>
                            <option value="">Choose a product...</option>
                            <option th:each="product : ${products}" 
                                    th:value="${product.id}" 
                                    th:text="${product.name}"></option>
                        </select>
                        <div th:if="${#lists.isEmpty(products)}" class="text-danger mt-2">
                            No products available.
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="quantity" class="form-label">Quantity:</label>
                        <input type="number" class="form-control" id="quantity" name="quantity" required min="1" />
                    </div>
                    <button type="submit" class="btn btn-success">Add Product</button>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Search Bar for Filtering Purchases -->
<div class="table-top">
<div class="row">
				<div class="col">
					<div class="mb-3" id="search">
						<div class="input-group">
							<input type="search" id="searchInput" class="form-control"
								placeholder="Search" onkeyup="searchProducts()"> <span
								class="input-group-text" style="background-color: white;">
								<span class="material-symbols-outlined">search</span>
							</span>
						</div>
					</div>
					</div>
					<div class="col-sm-1">
					<button class="filter"style="margin-top: 0.8em;" onclick="toggleFilter()"><span class="material-symbols-outlined" style="color: #f0f2f5;">
filter_alt
</span></button>
					</div>
					</div>
					<div id="myDIV" style="display:none">
		<!-- Quantity Range Filter -->
		<div class="row">
			<div class="col">
				<div class="mt-3">
				    <label for="quantityFilter" class="form-label">Filter by Quantity Range:</label>
				    <select id="quantityFilter" class="form-select">
				        <option value="">All</option>
				        <option value="0-10">0 - 10</option>
				        <option value="10-20">10 - 20</option>
				        <option value="20-30">20 - 30</option>
				        <option value="30+">30+</option>
				    </select>
				</div>
		      </div>
			<div class="col">
		<!-- Date Filter -->
		<div class="mt-3">
		    <label for="dateFilter" class="form-label">Filter by Date:</label>
		    <input type="date" id="dateFilter" class="form-control">
		</div>
		</div>
		</div>
	</div>

        <!-- Existing Purchases List -->
        
  <table class="table">
 
    <thead>
        <tr>
            <th>Product Name</th>
            <th>No of Products</th>
            <th>Created On</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody id="purchaseTableBody">
        <tr th:each="purchase : ${purchases}">
    <td th:text="${purchase.product.name}"></td> <!-- Ensure this is the first column -->
    <td th:text="${purchase.quantity}"></td>
    <td th:text="${#temporals.format(purchase.createdAt, 'dd-MM-yyyy')}"></td>
    <td>
        <form th:action="@{/purchase/delete}" method="post" style="display: inline;">
            <input type="hidden" name="id" th:value="${purchase.id}" />
            <button type="submit" class="btn btn-danger btn-sm" 
                onclick="return confirm('Are you sure you want to delete this purchase?')"><i class="fa-solid fa-trash-can" style="color: #ff0707;font-size: x-large;padding-bottom: 0.4em;"></i></button>
        </form>
    </td>
</tr>

        <tr th:if="${#lists.isEmpty(purchases)}">
            <td colspan="4" class="text-center">No purchases recorded.</td>
        </tr>
    </tbody>



        </table>
    </div>
    
    <script>
    
// JavaScript for Filtering Purchases by Product Name
document.getElementById("searchInput").addEventListener("input", function() {
    const filter = this.value.toLowerCase();
    const rows = document.querySelectorAll("#purchaseTableBody tr:not(#noPurchasesRow)");

    rows.forEach(row => {
        // Select the first <td> element in the row directly, skipping any <input> elements
        const productNameCell = row.querySelector("td");

        if (productNameCell) {
            const productName = productNameCell.textContent.toLowerCase();
            console.log("Product Name:", productName);  // Debugging line

            // Show or hide the row based on the filter match
            row.style.display = productName.includes(filter) ? "" : "none";
        } else {
            console.log("Product name cell not found for row:", row);  // Debugging line
            row.style.display = "";  // Make sure to reset rows without valid product names
        }
    });
});

//Attach event listeners for filtering
// Attach event listeners for filtering
document.getElementById("searchInput").addEventListener("input", filterTable);
document.getElementById("quantityFilter").addEventListener("change", filterTable);
document.getElementById("dateFilter").addEventListener("change", filterTable);

function filterTable() {
    const searchFilter = document.getElementById("searchInput").value.toLowerCase();
    const quantityFilter = document.getElementById("quantityFilter").value;
    const dateFilter = document.getElementById("dateFilter").value;
    const rows = document.querySelectorAll("#purchaseTableBody tr");

    console.log(`Filters applied - Search: ${searchFilter}, Quantity: ${quantityFilter}, Date: ${dateFilter}`);

    rows.forEach(row => {
        const productNameCell = row.querySelector("td:first-child");
        const productName = productNameCell.textContent.trim().toLowerCase();

        const quantityCell = row.querySelector("td:nth-child(2)");
        const quantity = parseInt(quantityCell.textContent.trim(), 10) || 0;

        const dateCell = row.querySelector("td:nth-child(3)");
        const rowDate = dateCell.textContent.trim().split(" ")[0]; // Extract only the date part


        // Log the data from each row for debugging
        console.log(`Row Data - Product: ${productName}, Quantity: ${quantity}, Date: ${rowDate}`);

        const matchesProductName = productName.includes(searchFilter);
        let matchesQuantity = true;

        // Quantity filter logic
        if (quantityFilter) {
    if (quantityFilter === "30+") {
        matchesQuantity = quantity >= 30;
    } else if (quantityFilter === "0-10") {
        matchesQuantity = quantity >= 0 && quantity <= 10;
    } else if (quantityFilter === "11-30") {
        matchesQuantity = quantity >= 11 && quantity <= 30;
    } else if (quantityFilter === "10-20") {
        matchesQuantity = quantity >= 10 && quantity <= 20;
    } else if (quantityFilter === "20-30") { // Add this case for 20-30
        matchesQuantity = quantity >= 20 && quantity <= 30;
    }
}

        const matchesDate = !dateFilter || rowDate === dateFilter;

        // Log whether the row matches the criteria
        console.log(`Matches - Product: ${matchesProductName}, Quantity: ${matchesQuantity}, Date: ${matchesDate}`);

        // Show or hide the row based on all criteria
        row.style.display = matchesProductName && matchesQuantity && matchesDate ? "" : "none";
    });
}



function toggleFilter() {
	  var x = document.getElementById("myDIV");
	  if (x.style.display === "none") {
	    x.style.display = "block";
	  } else {
	    x.style.display = "none";
	  }
	}



</script>

    <!-- Bootstrap Script -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>
