<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <style>
  :root {
    --primary-color: #2563eb;
    --accent-green: #10b981;
    --text-dark: #111827;
    --text-muted: #6b7280;
    --border-radius: 12px;
    --shadow-soft: 0 4px 14px rgba(0, 0, 0, 0.06);
  }

  body {
    
    background-color: #f9fafb;
    color: var(--text-dark);
  }

  /* Section Header */
  .section-title {
    font-weight: 700;
    color: var(--text-dark);
  }

  .btn {
    border-radius: 10px;
    font-weight: 500;
    padding: 8px 14px;
  }

  .btn-primary {
    background-color: var(--primary-color);
    border: none;
  }

  .btn-primary:hover {
    background-color: #1d4ed8;
  }

  .print-btn {
    background: var(--accent-green);
    color: #fff;
    border: none;
  }

  .print-btn:hover {
    background: #0f9a76;
  }

  /* Product Table */
  table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0 12px;
  }

  thead tr th {
    color: var(--text-muted);
    font-size: 14px;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    background: transparent;
    border-bottom: 1px solid #e5e7eb;
  }

  tbody tr {
    background: #fff;
    box-shadow: var(--shadow-soft);
    border-radius: var(--border-radius);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
  }

  tbody tr:hover {
    transform: scale(1.01);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
  }

 /* Product Image Container */
.product-image {
   width: 110px;
  height: 110px;
  object-fit: contain; /* keeps aspect ratio, no cropping */
  border-radius: 10px;
  background-color: #f3f4f6; /* light background for transparency */
  padding: 6px; /* gives breathing room inside the frame */
  border: 1px solid #e5e7eb;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.04);
}

/* Product Row Layout Alignment */
.product-row td:first-child {
  vertical-align: middle;
}

.d-flex.align-items-center img {
  flex-shrink: 0;
}

/* Ensure name and details align neatly next to the image */
.d-flex.align-items-center div {
  line-height: 1.4;
}


  .product-card h6 {
    font-weight: 600;
    margin-bottom: 4px;
  }

  .text-muted {
    color: var(--text-muted) !important;
  }

  .badge {
    background-color: #f3f4f6;
    color: var(--text-dark);
    font-size: 13px;
    border-radius: 8px;
    padding: 4px 8px;
    margin-right: 5px;
  }

  /* Actions */
  .product-actions .btn {
    border-radius: 50%;
    width: 38px;
    height: 38px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
  }

  .btn-outline-primary {
    border: 1px solid var(--primary-color);
    color: var(--primary-color);
  }

  .btn-outline-primary:hover {
    background: var(--primary-color);
    color: white;
  }

  .btn-outline-danger {
    border: 1px solid #ef4444;
    color: #ef4444;
  }

  .btn-outline-danger:hover {
    background: #ef4444;
    color: white;
  }

  /* Pagination */
  .pagination .page-item.active .page-link {
    background-color: var(--primary-color);
    border-color: var(--primary-color);
  }

  .pagination .page-link {
    color: var(--primary-color);
  }

  .pagination .page-link:hover {
    background-color: #e0e7ff;
  }

  /* Print area (unchanged core logic) */
  @media print {
    body * { visibility: hidden; }
    #printArea, #printArea * { visibility: visible; }
    #printArea {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      margin: 10px;
    }

    .barcode-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
    }

    .barcode-item {
      text-align: center;
      padding: 10px;
      border: 1px dashed #ccc;
      page-break-inside: avoid;
    }

    .barcode-item img {
      max-width: 180px;
      height: auto;
      display: block;
      margin: 0 auto;
    }

    .barcode-item p {
      margin-top: 6px;
      font-size: 14px;
      font-weight: bold;
    }
  }
</style>

</head>
<body>
  <!-- Products Section -->
  <section id="products-section" th:fragment="products">
    <!-- Hidden Product Barcodes Section -->
    <div id="printArea" style="display: none;">
      <div class="barcode-grid">
        <div th:each="product : ${products}" class="barcode-item">
          <img th:if="${product.barcodeImagePath != null}"
               th:src="@{'/images/barcodes/' + ${#strings.substring(product.barcodeImagePath, product.barcodeImagePath.lastIndexOf('/') + 1)}}" 
               alt="barcode" />
          <p th:text="${product.barcode}"></p>
        </div>
      </div>
    </div>
    
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2 class="section-title mb-0">Products</h2>
      <div class="d-flex gap-2">
        <a th:href="@{/products/create}" class="btn btn-primary">
          <i class="fas fa-plus me-2"></i> Add Product
        </a>
        <button type="button" class="btn print-btn" onclick="printBarcodes()">
          <i class="fas fa-print me-2"></i> Print Barcodes
        </button>
      </div>
    </div>

    <div class="row" th:if="${not #lists.isEmpty(products)}">
      <div class="col-12">
        <div class="card">
          <div class="card-body p-0">
            <div class="table-responsive">
              <table class="table table-hover mb-0">
                <thead>
                  <tr>
                    <th width="15%">Product</th>
                    <th width="25%">Details</th>
                    <th width="20%">Brand & Category</th>
                    <th width="15%">Price</th>
                    <th width="15%">Created</th>
                    <th width="10%" class="text-center">Actions</th>
                  </tr>
                </thead>
                <tbody id="productTableBody">
                  <tr th:each="product : ${products}" class="product-card product-row">
                    <td>
                      <div class="d-flex align-items-center">
                        <img th:if="${product.imageFileName != null}" 
                             th:src="@{'/images/' + ${product.imageFileName}}" 
                             class="product-image me-3" 
                             th:alt="${product.name}"/>
                        <img th:if="${product.imageFileName == null}" 
                             src="https://via.placeholder.com/150" 
                             class="product-image me-3" 
                             alt="No Image"/>
                        <div>
                          <h6 class="mb-0 fw-bold" th:text="${product.name}"></h6>
                        </div>
                      </div>
                    </td>
                    <td>
                      <p class="mb-1 text-muted small" th:text="${product.description} ?: 'No description'"></p>
                    </td>
                    <td>
                      <span class="badge bg-light text-dark me-1" th:text="${product.brand}"></span>
                      <span class="badge bg-light text-dark" th:text="${product.category}"></span>
                    </td>
                    <td>
                      <h6 class="mb-0 text-primary">â‚¹ <span th:text="${product.price}"></span></h6>
                    </td>
                    <td>
                      <small class="text-muted" th:text="${#dates.format(product.createdAt, 'dd-MM-yyyy')}"></small>
                    </td>
                    <td class="text-center product-actions">
                      <a th:href="@{/products/edit(id=${product.id})}" class="btn btn-sm btn-outline-primary me-1" title="Edit">
                        <i class="fas fa-edit"></i>
                      </a>
                      <a href="#"
                         class="btn btn-sm btn-outline-danger delete-btn"
                         data-bs-toggle="modal"
                         data-bs-target="#deleteModal"
                         th:data-delete-url="@{/products/delete(id=${product.id})}"
                         title="Delete">
                        <i class="fas fa-trash"></i>
                      </a>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Frontend Pagination Container -->
        <nav aria-label="Page navigation" class="mt-4">
          <ul class="pagination justify-content-center" id="frontendPagination"></ul>
        </nav>
      </div>
    </div>

    <!-- Empty State -->
    <div class="empty-state" th:if="${#lists.isEmpty(products)}">
      <i class="fas fa-box-open"></i>
      <h4 class="mt-3">No products found</h4>
      <p class="text-muted">Get started by adding your first product</p>
      <a th:href="@{/products/create}" class="btn btn-primary mt-2">
        <i class="fas fa-plus me-2"></i> Add Product
      </a>
    </div>
  </section>

  <!-- Delete Confirmation Modal -->
  <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="deleteModalLabel">Confirm Delete</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="d-flex align-items-center">
            <div class="bg-danger bg-opacity-10 p-3 rounded-circle me-3">
              <i class="fas fa-exclamation-triangle text-danger"></i>
            </div>
            <div>
              <h6 class="mb-1">Are you sure you want to delete this product?</h6>
              <p class="text-muted mb-0">This action cannot be undone.</p>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <a id="confirmDeleteBtn" href="#" class="btn btn-danger">Delete</a>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Delete Modal JS
    document.addEventListener('DOMContentLoaded', () => {
      const deleteModalEl = document.getElementById('deleteModal');
      const confirmBtn = document.getElementById('confirmDeleteBtn');

      if (deleteModalEl) {
        deleteModalEl.addEventListener('show.bs.modal', event => {
          const button = event.relatedTarget;
          const deleteUrl = button.dataset.deleteUrl;
          confirmBtn.href = deleteUrl;
        });
      }
    });

    function printBarcodes() {
      document.getElementById("printArea").style.display = "block";
      window.print();
      document.getElementById("printArea").style.display = "none";
    }

    // Frontend Pagination JS
    document.addEventListener('DOMContentLoaded', () => {
      const rows = Array.from(document.querySelectorAll('.product-row'));
      const rowsPerPage = 5; // adjust rows per page
      const totalPages = Math.ceil(rows.length / rowsPerPage);
      const paginationContainer = document.getElementById('frontendPagination');

      let currentPage = 1;

      function showPage(page) {
        currentPage = page;
        const start = (page - 1) * rowsPerPage;
        const end = start + rowsPerPage;

        rows.forEach((row, index) => {
          row.style.display = (index >= start && index < end) ? '' : 'none';
        });

        renderPagination();
      }

      function renderPagination() {
        paginationContainer.innerHTML = '';

        // Previous button
        const prevLi = document.createElement('li');
        prevLi.classList.add('page-item');
        if (currentPage === 1) prevLi.classList.add('disabled');

        const prevA = document.createElement('a');
        prevA.classList.add('page-link');
        prevA.href = '#';
        prevA.innerHTML = `<i class="fas fa-chevron-left me-1"></i> Previous`;
        prevA.addEventListener('click', e => {
          e.preventDefault();
          if (currentPage > 1) showPage(currentPage - 1);
        });
        prevLi.appendChild(prevA);
        paginationContainer.appendChild(prevLi);

        // Page numbers
        for (let i = 1; i <= totalPages; i++) {
          const li = document.createElement('li');
          li.classList.add('page-item');
          if (i === currentPage) li.classList.add('active');

          const a = document.createElement('a');
          a.classList.add('page-link');
          a.href = '#';
          a.textContent = i;
          a.addEventListener('click', e => {
            e.preventDefault();
            showPage(i);
          });

          li.appendChild(a);
          paginationContainer.appendChild(li);
        }

        // Next button
        const nextLi = document.createElement('li');
        nextLi.classList.add('page-item');
        if (currentPage === totalPages) nextLi.classList.add('disabled');

        const nextA = document.createElement('a');
        nextA.classList.add('page-link');
        nextA.href = '#';
        nextA.innerHTML = `Next <i class="fas fa-chevron-right ms-1"></i>`;
        nextA.addEventListener('click', e => {
          e.preventDefault();
          if (currentPage < totalPages) showPage(currentPage + 1);
        });
        nextLi.appendChild(nextA);
        paginationContainer.appendChild(nextLi);
      }

      // Initialize first page
      showPage(1);
    });
  </script>
</body>
</html>
