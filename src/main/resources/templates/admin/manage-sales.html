	<!DOCTYPE html>
	<html xmlns:th="http://www.thymeleaf.org">
	<head>
	  <style>
	    /* Manage Sales specific styles */
	    .filter-section {
	      background-color: #f8fafc;
	      border-radius: 10px;
	      padding: 20px;
	      margin-bottom: 20px;
	      border: 1px solid #e2e8f0;
	    }
	
	    .filter-toggle {
	      background: none;
	      border: none;
	      color: #4361ee;
	      font-weight: 500;
	      display: flex;
	      align-items: center;
	      gap: 8px;
	      transition: all 0.3s ease;
	    }
	
	    .filter-toggle:hover {
	      color: #3f37c9;
	    }
	
	    .search-container {
	      position: relative;
	    }
	
	    .search-container .form-control {
	      padding-left: 45px;
	    }
	
	    .search-icon {
	      position: absolute;
	      left: 15px;
	      top: 50%;
	      transform: translateY(-50%);
	      color: #94a3b8;
	      z-index: 5;
	    }
	  </style>
	</head>
	<body>
	  <!-- Manage Sales Section -->
	   <section id="manage-purchase-section">
     <div th:fragment="manage-purchase-section-content">
	    <div class="card shadow-sm">
	      <div class="card-body">
	        <div class="d-flex justify-content-between align-items-center mb-4">
	          <div>
	            <h2 class="section-title mb-1">Manage Sales</h2>
	            <p class="text-muted mb-0">Manage your units and sales</p>
	          </div>
	          <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addUnitsModal">
	            <i class="fas fa-plus-circle me-2"></i> Add New Unit
	          </button>
	        </div>
	
	        <!-- Search and Filters -->
	        <div class="filter-section">
	          <div class="row align-items-center">
	            <div class="col-md-8">
	              <div class="search-container">
	                <i class="fas fa-search search-icon"></i>
	                <input type="search" id="searchInput" class="form-control"
	                       placeholder="Search products..." onkeyup="filterTable()">
	              </div>
	            </div>
	            <div class="col-md-4 text-end">
	              <button class="filter-toggle" onclick="toggleFilter()">
	                <i class="fas fa-filter me-1"></i> Filters
	              </button>
	            </div>
	          </div>
	          
	          <div id="filterSection" style="display:none" class="mt-3">
	            <div class="row g-3">
	              <div class="col-md-6">
	                <label for="quantityFilter" class="form-label">Filter by Quantity Range</label>
	                <select id="quantityFilter" class="form-select" onchange="filterTable()">
	                  <option value="">All</option>
	                  <option value="0-10">0 - 10</option>
	                  <option value="10-20">10 - 20</option>
	                  <option value="20-30">20 - 30</option>
	                  <option value="30+">30+</option>
	                </select>
	              </div>
	              <div class="col-md-6">
	                <label for="dateFilter" class="form-label">Filter by Date</label>
	                <input type="date" id="dateFilter" class="form-control" onchange="filterTable()">
	              </div>
	            </div>
	          </div>
	        </div>
	
	        <!-- Purchases Table -->
	        <div class="table-responsive">
	          <table class="table">
	            <thead>
	              <tr>
	                <th>Product Name</th>
	                <th>No of Products</th>
	                <th>Created On</th>
	                <th>Actions</th>
	              </tr>
	            </thead>
	            <tbody id="purchaseTableBody">
	              <tr th:each="purchase : ${purchases}">
	                <td th:text="${purchase.product.name}"></td>
	                <td>
	                  <span class="badge bg-primary" th:text="${purchase.quantity}"></span>
	                </td>
	                <td th:text="${#temporals.format(purchase.createdAt, 'dd-MM-yyyy')}"></td>
	                <td>
	                  <button type="button" th:onclick="'deletePurchase(' + ${purchase.id} + ')'" class="btn btn-sm btn-outline-danger">
	                    <i class="fas fa-trash"></i>
	                  </button>
	                </td>
	              </tr>
	              <tr th:if="${#lists.isEmpty(purchases)}">
	                <td colspan="4" class="text-center py-5">
	                  <div class="empty-state">
	                    <i class="fas fa-clipboard-list"></i>
	                    <h5 class="mt-3">No purchases recorded</h5>
	                    <p class="text-muted">Add your first purchase to get started</p>
	                  </div>
	                </td>
	              </tr>
	            </tbody>
	          </table>
	        </div>
	      </div>
	    </div>
	   
	
	    <!-- Add Units Modal -->
	    <div class="modal fade" id="addUnitsModal" tabindex="-1" aria-labelledby="addUnitsModalLabel" aria-hidden="true">
	      <div class="modal-dialog">
	        <div class="modal-content">
	          <div class="modal-header">
	            <h5 class="modal-title" id="addUnitsModalLabel">Add New Units</h5>
	            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
	          </div>
	          <div class="modal-body">
	            <!-- Success and Error Messages -->
	            <div th:if="${successMessage}" class="alert alert-success" role="alert">
	              <i class="fas fa-check-circle me-2"></i>
	              <span th:text="${successMessage}"></span>
	            </div>
	            <div th:if="${errorMessage}" class="alert alert-danger" role="alert">
	              <i class="fas fa-exclamation-circle me-2"></i>
	              <span th:text="${errorMessage}"></span>
	            </div>
	
	            <!-- Add Purchase Form -->
	            <form id="addPurchaseForm" th:action="@{/manage-purchase}" method="post">
	              <div class="mb-3">
	                <label for="product" class="form-label">Select Product</label>
	                <select class="form-select" name="productId" id="product" required>
	                  <option value="">Choose a product...</option>
	                  <option th:each="product : ${products}" 
	                          th:value="${product.id}" 
	                          th:text="${product.name}"></option>
	                </select>
	                <div th:if="${#lists.isEmpty(products)}" class="text-danger mt-2">
	                  <i class="fas fa-info-circle me-1"></i> No products available.
	                </div>
	              </div>
	
	              <div class="mb-3">
	                <label for="quantity" class="form-label">Quantity</label>
	                <input type="number" class="form-control" id="quantity" name="quantity" required min="1" />
	              </div>
	
	              <div class="d-grid">
	                <button type="submit" class="btn btn-success">
	                  <i class="fas fa-plus me-2"></i> Add Product
	                </button>
	              </div>
	            </form>
	          </div>
	        </div>
	      </div>
	    </div>
	 </div>
	  </section>
	
	  <script>
	    // Manage Sales specific JavaScript
	    function deletePurchase(id) {
	      if (!confirm("Are you sure you want to delete this purchase?")) return;
	
	      fetch("/purchase/delete?id=" + id, { method: "POST" })
	        .then(() => {
	          // Reload the manage sales section instead of full page
	          loadManageSalesSection();
	        })
	        .catch(error => {
	          console.error('Error deleting purchase:', error);
	          alert('Error deleting purchase');
	        });
	    }
	
	    function toggleFilter() {
	      const filterSection = document.getElementById("filterSection");
	      if (filterSection) {
	        if (filterSection.style.display === "none" || !filterSection.style.display) {
	          filterSection.style.display = "block";
	        } else {
	          filterSection.style.display = "none";
	        }
	      }
	    }
	
	    function filterTable() {
	      const searchFilter = document.getElementById("searchInput")?.value.toLowerCase() || '';
	      const quantityFilter = document.getElementById("quantityFilter")?.value || '';
	      const dateFilter = document.getElementById("dateFilter")?.value || '';
	      const rows = document.querySelectorAll("#purchaseTableBody tr");
	
	      rows.forEach(row => {
	        const productNameCell = row.querySelector("td:first-child");
	        const productName = productNameCell?.textContent.trim().toLowerCase() || '';
	
	        const quantityCell = row.querySelector("td:nth-child(2)");
	        const quantity = parseInt(quantityCell?.textContent.trim(), 10) || 0;
	
	        const dateCell = row.querySelector("td:nth-child(3)");
	        const rowDate = dateCell?.textContent.trim().split(" ")[0] || '';
	
	        const matchesProductName = productName.includes(searchFilter);
	        let matchesQuantity = true;
	
	        if (quantityFilter) {
	          if (quantityFilter === "30+") {
	            matchesQuantity = quantity >= 30;
	          } else if (quantityFilter === "0-10") {
	            matchesQuantity = quantity >= 0 && quantity <= 10;
	          } else if (quantityFilter === "10-20") {
	            matchesQuantity = quantity >= 10 && quantity <= 20;
	          } else if (quantityFilter === "20-30") {
	            matchesQuantity = quantity >= 20 && quantity <= 30;
	          }
	        }
	
	        const matchesDate = !dateFilter || rowDate === dateFilter;
	
	        row.style.display = matchesProductName && matchesQuantity && matchesDate ? "" : "none";
	      });
	    }
	
	    // Load manage sales section
	    function loadManageSalesSection() {
	    	
	    	console.log("logging*************");
	    	
	      fetch('/manage-purchase', {
	        headers: { 'X-Requested-With': 'XMLHttpRequest' }
	      })
	      .then(resp => resp.text())
	      .then(html => {
	        const section = document.getElementById('manage-purchase-section');
	        if (section) {
	          section.innerHTML = html;
	          initializeManageSalesEvents();
	        }
	      })
	      .catch(err => console.error('Error loading Manage Sales section:', err));
	    }
	
	    // Initialize event listeners for manage sales
	    function initializeManageSalesEvents() {
	      const form = document.getElementById('addPurchaseForm');
	      const modalEl = document.getElementById('addUnitsModal');
	
	      if (form && modalEl) {
	        // Reset form whenever the modal closes
	        modalEl.addEventListener('hidden.bs.modal', function () {
	          form.reset();
	        });
	
	        form.addEventListener('submit', function(e) {
	          e.preventDefault();
	
	          const formData = new FormData(form);
	
	          fetch(form.action, {
	            method: 'POST',
	            body: formData,
	            headers: { 'X-Requested-With': 'XMLHttpRequest' }
	          })
	          .then(resp => resp.text())
	          .then(html => {
	            // Replace the section content with updated content
	            const section = document.getElementById('manage-purchase-section');
	            section.innerHTML = html;
	            
	            // Close the modal
	            const modal = bootstrap.Modal.getInstance(modalEl);
	            if (modal) modal.hide();
	            
	            // Re-initialize events
	            initializeManageSalesEvents();
	            
	            // Refresh dashboard if it's visible
	            if (typeof refreshDashboard === 'function') {
	              refreshDashboard();
	            }
	          })
	          .catch(err => console.error(err));
	        });
	      }
	    }
	
	    // Initialize when section is loaded
	    document.addEventListener('DOMContentLoaded', function() {
	    	  loadManageSalesSection();
	      initializeManageSalesEvents();
	    });
	
	    // Export functions for global access
	    window.deletePurchase = deletePurchase;
	    window.toggleFilter = toggleFilter;
	    window.filterTable = filterTable;
	    window.loadManageSalesSection = loadManageSalesSection;
	    
	    
	  </script>
	</body>
	</html>